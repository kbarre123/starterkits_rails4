<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<div class="row">
  <div class="col-sm-12 col-md-6">
    <div class="jumbotron" id="bus_well">
      <h3 class="bus_name"><strong><%= @business.title %></strong></h3>
      <p>
          <strong>Average Rating: </strong><%= number_with_precision(
              @business.reviews.average("rating"), :precision => 2 || 0) 
              %>
      </p>
      <% if @business.text.blank? %>
            
      <% else %>
        <p>
          <strong>About:</strong>
          <%= @business.text %>
        </p>
      <% end %>
      
      <p>
        <strong>Address:</strong>
        <span class="center-block"><a href="http://maps.apple.com/?q=<%= @business.title %>%20<%= @business.city %>,%20<%= @business.state %>%20<%= @business.zip_code %>&z=14">
          
          <%= @business.street %><br>
          <%= @business.city %>, 
          <%= @business.state %>  
          <%= @business.zip_code %>
        </a></span>
      </p>

      <p>
        <strong>Telephone:</strong>
        <%= @business.telephone %>
      </p>
      <% if @business.website.blank? %>
            
      <% else %>
        <p>
          <strong>Website:</strong>
          <a href="<%= @business.website %>" target="blank">Link</a>
        </p>
      <% end %>

      <% if @business.op_hours.blank? %>
            
      <% else %>
        <p>
        <strong>Hours of Operation:</strong>
        <%= @business.op_hours %>
      </p>
      <% end %>
      
      <p>
        <strong>Category:</strong>
        <%= @business.category %>
      </p>
      <p>
        <% if can? :update, @business %>
            <%= link_to "Edit", edit_business_path(@business) %> | 
        <% end %>
        <% if can? :destroy, @business %>
            <%= link_to "Destroy", @business, data: { confirm: 'Are you sure?' }, method: :delete %>
        <% end %>
      </p>
    </div><!-- Jumbotron -->
  </div><!-- col-sm-12 col-md-6 -->
  <div class="col-sm-12 col-md-6">
    <!-- Main Map -->
    <div style='width: 800px;'>
      <div id="map" style='width: 800px; height: 400px;'></div>
    </div>
    <!-- Street View Pic -->
    <div>
      <a href="http://maps.googleapis.com/maps/api/streetview?size=500x500&location=<%= @business.latitude %>,<%= @business.longitude %>&fov=90&heading=<%= @business.map_heading %>&pitch=10"><img src="http://maps.googleapis.com/maps/api/streetview?size=150x150&location=<%= @business.latitude %>,<%= @business.longitude %>&fov=90&heading=<%= @business.map_heading %>&pitch=10" class="bus_thumb img-responsive img-rounded"></a>
    </div>
    <br>
  </div><!-- col-sm-12 col-md-6 -->
</div><!-- row -->
<div class="row">
  <div class="col-sm-12">
    <div class="well">
      <h2>Add a review:</h2>
      <%= simple_form_for([@business, @business.reviews.build]) do |f| %>
        <%= f.error_notification %>
        <p>
          <%= f.input :review %>
        </p>
        <p>
          <%= f.input :rating, collection: 1..10 %>
        </p>
        <p>
          <%= f.submit :class => 'btn btn-primary' %>
        </p>
      <% end %> 
      <%= link_to('Back', businesses_path, :class => 'btn btn-primary')  %>
    </div><!-- well -->
  </div><!-- col-sm-12 -->
</div><!-- row -->
<div class="row">
  <div class="col-sm-12">
    <h2>Reviews</h2>
    <% if @business.reviews.count == 0 %>
    <p class="bus_name_home">
      Be the first to review this business!
    </p>
    <% else %>
      <%= render @reviews.reverse_order %>
    <% end %>
    <div class="pagination">
      <%= will_paginate @reviews, renderer: BootstrapPagination::Rails %>
    </div>
  </div><!-- col-sm-12 -->
</div>
<!-- Below is script for gmaps4rails -->
<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    handler.map.centerOn(markers[0]);
    handler.map.serviceObject.setZoom(14);
  });
</script>