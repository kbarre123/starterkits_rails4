<% cache(cache_key_for_comments(@comments)) do %>
  <% @comments.each do |comment| %>  
    <% cache(comment) do %>
      <% if !comment.user_id.nil? %>
        <div class="comment_well">
          <p>
            <span><%= comment.text %></span><br>
            <%= render 'users/avatar', user: comment.user %> - <span class="reviewer_quote"><%= comment.user.first_name %> <%= comment.user.last_name %></span>
          </p>
          <span class = "timestamp">
            posted <%= time_ago_in_words(comment.created_at) %> ago.
          </span>
          <% if can? :manage, comment %>
            <span>
              <%= link_to "Edit", edit_polymorphic_path([@commentable, comment]) %> |
              <% destroy_modal_id = 'destroy_modal_id' %>
              <%= link_to I18n.t('comment.destroy.link'), [@commentable, comment], data: { confirm: I18n.t('comment.destroy.prompt'), confirm_modal: "##{destroy_modal_id}" }, method: :delete %>
              <%= render 'layouts/destroy_modal', id: destroy_modal_id, i18n_prefix: 'comment.destroy' %>
            </span>
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% end %>
<% end %>